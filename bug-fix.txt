this is a bug file to fix some issues.
some changes from master 
